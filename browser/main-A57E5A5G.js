import{a as P}from"./chunk-DLEJWGRM.js";import{a as E}from"./chunk-KS27GDCL.js";import{K as k,L as w,M as G,O,P as F,Q as U,R as S,T,U as D,V as r,b as l,c as d,e as c,f as s,g as n,k as H,l as f,m as p,o as N,q as h,r as v,s as x,z as A}from"./chunk-WKEIMEWF.js";var u=class e{constructor(o,t){this.authService=o;this.router=t;console.log("[AuthGuard] constructor")}canActivate(o,t){return console.log("[AuthGuard] canActivate called"),this.authService.currentUser$.pipe(d(1),l(i=>(console.log("[AuthGuard] current user:",i),i?!0:(console.log("[AuthGuard] user not authenticated, redirect to /auth/login"),this.router.createUrlTree(["/auth/login"])))))}static \u0275fac=function(t){return new(t||e)(n(r),n(S))};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};var g=class e{constructor(o,t){this.authService=o;this.router=t;console.log("[RoleGuard] constructor")}canActivate(o,t){console.log("[RoleGuard] canActivate called");let i=o.data.roles;return this.authService.currentUser$.pipe(d(1),l(m=>(console.log("[RoleGuard] current user:",m),m&&i.includes(m.ruolo)?(console.log("[RoleGuard] access granted"),!0):(console.log("[RoleGuard] access denied, redirect to /access-denied"),this.router.createUrlTree(["/access-denied"])))))}static \u0275fac=function(t){return new(t||e)(n(r),n(S))};static \u0275prov=c({token:e,factory:e.\u0275fac,providedIn:"root"})};var C=class e{static \u0275fac=function(t){return new(t||e)};static \u0275cmp=f({type:e,selectors:[["app-access-denied"]],decls:7,vars:0,consts:[[1,"access-denied-container"],["routerLink","/home"]],template:function(t,i){t&1&&(h(0,"div",0)(1,"h1"),A(2,"Accesso Negato"),v(),h(3,"p"),A(4,"Non hai i permessi necessari per visualizzare questa pagina."),v(),h(5,"a",1),A(6,"Torna alla Home"),v()())},styles:[".access-denied-container[_ngcontent-%COMP%]{margin:2rem;text-align:center}"]})};var $=[{path:"auth",loadChildren:()=>import("./chunk-VSP633L3.js").then(e=>e.AuthModule)},{path:"home",loadChildren:()=>import("./chunk-WCLHKPV3.js").then(e=>e.HomeModule),canActivate:[u]},{path:"admin",component:E,canActivate:[u,g],data:{roles:["admin"]}},{path:"access-denied",component:C},{path:"",redirectTo:"home",pathMatch:"full"},{path:"**",redirectTo:"home"}],R=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=p({type:e});static \u0275inj=s({imports:[T.forRoot($),T]})};var b=class e{constructor(o){this.authService=o}title="FrontendGestioneUtenti";appReady=!1;ngOnInit(){this.authService.checkTokenOnLoad().then(()=>{this.appReady=!0})}static \u0275fac=function(t){return new(t||e)(H(r))};static \u0275cmp=f({type:e,selectors:[["app-root"]],standalone:!1,decls:1,vars:0,template:function(t,i){t&1&&x(0,"router-outlet")},dependencies:[U],encapsulation:2})};var y=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=p({type:e});static \u0275inj=s({imports:[k]})};var I=class e{constructor(o){this.authService=o}intercept(o,t){let i=this.authService.getToken(),m=o.url.startsWith(D.apiUrl);if(i&&m){let z=o.clone({headers:o.headers.set("Authorization",`Bearer ${i}`)});return t.handle(z)}return t.handle(o)}static \u0275fac=function(t){return new(t||e)(n(r))};static \u0275prov=c({token:e,factory:e.\u0275fac})};function Z(e){return()=>e.checkTokenOnLoad()}var M=class e{static \u0275fac=function(t){return new(t||e)};static \u0275mod=p({type:e,bootstrap:[b]});static \u0275inj=s({providers:[{provide:N,useFactory:Z,deps:[r],multi:!0},{provide:O,useClass:I,multi:!0}],imports:[G,R,F,P,y]})};w().bootstrapModule(M,{ngZoneEventCoalescing:!0}).catch(e=>console.error(e));
